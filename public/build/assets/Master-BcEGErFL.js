import{W as _,r as s,j as r}from"./app-m-HMlsfD.js";import P from"./Head-DhxMtF_9.js";import $ from"./Sidevar-B5GHDRtP.js";import q from"./MasterModal-B7byeV-e.js";import{S as F}from"./ShiftTable-B8d0UZdh.js";import H from"./Confirm-Da8JX0p0.js";import J from"./OpenCa-BTyQTLV-.js";import L from"./AddMaster-DyvfvKSs.js";import{B as i}from"./Box-CR25OIeg.js";import{B as d}from"./Button-BrUfJDNj.js";import{P as Y}from"./Paper-BaBfR29X.js";import{T as G}from"./Typography-Bx8_tTwK.js";import"./createSvgIcon-DvOanfjP.js";import"./createSimplePaletteValueFilter-D2-dPfC5.js";import"./Dropdown-w67JNyhh.js";import"./transition-_sPBLcFl.js";import"./Menu-De1-uKzX.js";import"./index-B995chQ5.js";import"./isHostComponent-DVu5iVWx.js";import"./useSlot-CrG6-reF.js";import"./Modal-Cr83vY5A.js";import"./TransitionGroupContext-C5-MDFVv.js";import"./ButtonBase-C_SP5a7J.js";import"./List-Cp0FmyTt.js";import"./dividerClasses-BjDrb0Wk.js";import"./listItemTextClasses-DuQvMp_m.js";import"./listItemIconClasses-B-r5IkUB.js";import"./Logout-fnhdqEaq.js";import"./LogoutModal-DxrNTA_C.js";import"./ListItemText-Dx0vTXA3.js";import"./ja-BrXKx_qe.js";import"./index-D4XFpoAf.js";import"./EditCalendar-BBwrrIsk.js";import"./isMuiElement-Ct4HNmcj.js";import"./useThemeProps-DnS_9u4U.js";function zt({shifts:c,count:K,datas:Q}){const{setData:x,delete:b,processing:C,errors:U}=_(),[u,g]=s.useState(!1),[M,h]=s.useState([]),[l,w]=s.useState({}),[V,k]=s.useState(null),[f,m]=s.useState(!1),[j,S]=s.useState(!1);s.useEffect(()=>{const e=[];c.forEach(t=>{const o=e.find(n=>n.date===t.date);o?o.members.includes(t.user.name)||o.members.push(t.user.name):e.push({date:t.date,members:[t.user.name]})}),h(e)},[c]);const D=()=>{const e=new Date,t=e.getMonth(),o=e.getFullYear(),n=new Date(o,t+1,1),a=new Date(o,t+2,0);return{nextMonthStart:n,nextMonthEnd:a}},{nextMonthStart:v,nextMonthEnd:O}=D();s.useEffect(()=>{const e=c.filter(t=>{const o=new Date(t.date);return o<v||o>O}).map(t=>t.date);x("dates",e)},[]);const y=()=>{const{nextMonthStart:e,nextMonthEnd:t}=D(),o=c.filter(n=>{const a=new Date(n.date);return a<e||a>t}).map(n=>n.date);x("dates",o),b(route("master.del"),{onSuccess:()=>{alert("削除が成功しました"),h([]),m(!1)},onError:()=>{alert("削除に失敗しました")}})},A=JSON.parse(localStorage.getItem("shifts"))||{},E=(e=>{const t=[];let o=1;const n=new Date().toISOString();for(const[a,p]of Object.entries(e))p.forEach(N=>{t.push({id:o++,user_id:N,date:a,created_at:n,updated_at:n})});return t})(A),T=(e,t)=>{w(o=>{const n=o[t]||[];return n.includes(e)?{...o,[t]:n.filter(a=>a!==e)}:{...o,[t]:[...n,e]}}),k(t)},B=[...M].sort((e,t)=>new Date(e.date)-new Date(t.date)),[W,z]=s.useState(!1),[I,R]=s.useState(!1);return r.jsxs("div",{className:"master-container",children:[r.jsx(P,{isOpen:u,setIsOpen:g}),u&&r.jsx($,{setIsOpen:g}),r.jsx(i,{sx:{marginTop:3,marginRight:1,textAlign:"right"},children:r.jsx(d,{onClick:y,variant:"contained",color:"error",sx:{fontWeight:"bold",padding:"4px 8px",fontSize:"13px","&:hover":{backgroundColor:"#d32f2f"}},disabled:C,children:"先月分のシフトの削除"})}),r.jsx(i,{sx:{marginTop:4,marginRight:2,marginLeft:2},children:B.map(e=>r.jsxs(Y,{sx:{padding:2,marginBottom:2,backgroundColor:"#f9f9f9"},children:[r.jsxs(G,{variant:"h6",sx:{fontWeight:"bold",marginBottom:1},children:["日付: ",e.date]}),r.jsx(i,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:e.members.map((t,o)=>{var n,a,p;return r.jsx(d,{variant:"outlined",sx:{padding:"8px 16px",borderColor:(n=l[e.date])!=null&&n.includes(t)?"primary.main":"grey.500",color:(a=l[e.date])!=null&&a.includes(t)?"white":"black",backgroundColor:(p=l[e.date])!=null&&p.includes(t)?"blue":""},onClick:()=>T(t,e.date),children:t},`${t}-${o}`)})})]},e.date))}),r.jsx(i,{sx:{textAlign:"center",marginTop:3},children:r.jsx(d,{onClick:()=>m(!0),variant:"outlined",sx:{margin:"10px",fontSize:"16px",fontWeight:"bold",borderColor:"primary.main","&:hover":{backgroundColor:"primary.main",color:"white"}},children:"表の作成"})}),r.jsx(F,{datas:E}),f&&r.jsx(q,{open:f,setOpen:m,datas:l}),r.jsx(i,{sx:{textAlign:"center",marginTop:3},children:r.jsx(d,{onClick:()=>S(!0),variant:"outlined",sx:{margin:"10px",fontSize:"16px",fontWeight:"bold","&:hover":{backgroundColor:"primary.main",color:"white"}},children:"公開"})}),j&&r.jsx(H,{open:j,setOpen:S}),r.jsxs(i,{sx:{marginTop:4,textAlign:"center"},children:[r.jsx(d,{variant:"outlined",onClick:()=>z(e=>!e),sx:{margin:"10px",fontSize:"16px",fontWeight:"bold","&:hover":{backgroundColor:"primary.main",color:"white"}},children:"お盆など特定の日を入力できないようにする"}),r.jsx("p",{children:"※基本的にデフォルトで休日は除外されています"}),W&&r.jsx(i,{sx:{marginTop:2,textAlign:"center"},children:r.jsx(J,{})})]}),r.jsxs(i,{sx:{textAlign:"center",marginTop:3},children:[r.jsx(d,{variant:"outlined",onClick:()=>R(e=>!e),sx:{margin:"10px",fontSize:"16px",fontWeight:"bold","&:hover":{backgroundColor:"primary.main",color:"white"}},children:"管理者の追加"}),I&&r.jsx(L,{})]})]})}export{zt as default};
